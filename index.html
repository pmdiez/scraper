<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scraper EfectoLED - Paneles 60x60</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">

    <div class="max-w-6xl mx-auto p-6">
        <header class="mb-10 text-center">
            <h1 class="text-4xl font-bold text-gray-800">Panel Control de Precios LED</h1>
            <p class="text-gray-600 mt-2">Buscador de paneles 60x60cm en tiempo real</p>
        </header>

        <div class="bg-white p-6 rounded-xl shadow-sm mb-8 flex flex-col md:flex-row gap-4 items-center justify-between">
            <div class="relative w-full md:w-1/2">
                <input type="text" id="searchInput" placeholder="Buscar por Referencia o Nombre..." 
                    class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all">
                <div class="absolute left-3 top-2.5 text-gray-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>
            <div id="status" class="text-sm font-medium text-blue-600 bg-blue-50 px-4 py-2 rounded-full italic">
                Cargando datos...
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <table class="w-full text-left border-collapse">
                <thead class="bg-gray-800 text-white">
                    <tr>
                        <th class="p-4 uppercase text-xs font-semibold">Ref</th>
                        <th class="p-4 uppercase text-xs font-semibold">Producto</th>
                        <th class="p-4 uppercase text-xs font-semibold text-right">Precio</th>
                        <th class="p-4 uppercase text-xs font-semibold text-center">Acción</th>
                    </tr>
                </thead>
                <tbody id="productTable" class="divide-y divide-gray-200">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        let allProducts = [];

        async function fetchProducts() {
            try {
                const response = await fetch('/api/scrape');
                const result = await response.json();
                
                if (result.success) {
                    allProducts = result.data;
                    renderTable(allProducts);
                    document.getElementById('status').innerText = `${allProducts.length} productos cargados`;
                } else {
                    throw new Error('Error en la API');
                }
            } catch (error) {
                document.getElementById('status').innerText = 'Error al cargar datos';
                document.getElementById('status').classList.replace('text-blue-600', 'text-red-600');
            }
        }

        function renderTable(products) {
    const tbody = document.getElementById('productTable');
    tbody.innerHTML = products.map(p => `
        <tr class="hover:bg-gray-50 transition-colors">
            <td class="p-4 font-mono text-xs text-gray-500">${p.ref}</td>
            <td class="p-4">
                <div class="flex items-center gap-4">
                    <img src="${p.imagen}" alt="led" class="w-12 h-12 object-cover rounded border bg-white shadow-sm">
                    <span class="font-medium text-gray-800 text-sm">${p.nombre}</span>
                </div>
            </td>
            <td class="p-4 text-right font-bold text-green-600">${p.precio}</td>
            <td class="p-4 text-center">
                <a href="${p.enlace}" target="_blank" class="bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-xs font-semibold hover:bg-blue-100 transition-all">
                    Ver
                </a>
            </td>
        </tr>
    `).join('');
}

        // Filtro de búsqueda
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = allProducts.filter(p => 
                p.ref.toLowerCase().includes(term) || 
                p.nombre.toLowerCase().includes(term)
            );
            renderTable(filtered);
        });

        // Carga inicial
        fetchProducts();
    </script>
</body>
</html>